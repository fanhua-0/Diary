<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„äº‘ç«¯æ—¥è®°æœ¬</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <style>
        /* --- 1. èƒŒæ™¯ï¼šä¿æŒä½ å–œæ¬¢çš„é€äº®æ¢¦å¹»è‰² --- */
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            /* æµ…ç´« -> æµ…è“ï¼Œé€šé€æ„Ÿ */
            background: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%);
            background-attachment: fixed;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            overflow-x: hidden;
            color: #555;
        }

        .main-container {
            max-width: 1200px; /* ä¿æŒå®½å± */
            margin: 0 auto;
            padding: 20px;
        }

        /* --- 2. é¡¶éƒ¨å¯¼èˆª --- */
        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px; /* é—´è·æ”¹å° */
            padding: 10px 25px;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px);
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 20px rgba(142, 197, 252, 0.2);
        }

        .app-title {
            font-size: 20px;
            font-weight: 800;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* --- 3. å¸ƒå±€ï¼šé«˜å¯†åº¦ç½‘æ ¼ --- */
        .cloud-grid {
            display: grid;
            /*
               å…³é”®æ”¹åŠ¨ï¼šminmax æ”¹ä¸º 210px
               è¿™æ„å‘³ç€å±å¹•å¤Ÿå®½æ—¶ï¼Œä¸€è¡Œå¯ä»¥æ”¾ 4-5 ä¸ªäº‘æœµ
            */
            grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
            gap: 25px; /* é—´è·æ”¹å°ï¼Œæ›´ç´§å‡‘ */
            padding-bottom: 60px;
        }

        /* --- 4. è¿·ä½ ç‰ˆæ‰‹ç»˜äº‘æœµ --- */
        .cloud-card {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 200' preserveAspectRatio='none'%3E%3Cdefs%3E%3ClinearGradient id='rainbow' x1='0%25' y1='0%25' x2='100%25' y2='0%25'%3E%3Cstop offset='0%25' stop-color='%23ff9a9e'/%3E%3Cstop offset='20%25' stop-color='%23fad0c4'/%3E%3Cstop offset='40%25' stop-color='%23ffd1ff'/%3E%3Cstop offset='60%25' stop-color='%23a18cd1'/%3E%3Cstop offset='80%25' stop-color='%2384fab0'/%3E%3Cstop offset='100%25' stop-color='%238fd3f4'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath d='M30,100 Q20,80 40,60 Q30,30 60,20 Q80,0 110,10 Q140,-10 170,10 Q200,0 230,20 Q260,10 280,50 Q300,70 280,100 Q300,130 270,150 Q250,180 210,170 Q180,190 140,180 Q100,200 60,180 Q20,190 10,150 Q-10,120 30,100 Z' fill='%23fffdf5' stroke='url(%23rainbow)' stroke-width='5' vector-effect='non-scaling-stroke'/%3E%3C/svg%3E");

            background-repeat: no-repeat;
            background-size: 100% 100%;
            background-position: center;
            background-color: transparent;
            box-shadow: none;
            border: none;

            /* å†…è¾¹è·ç¼©å°ï¼Œé€‚é…å°å°ºå¯¸ */
            padding: 30px 25px 30px 25px;

            /* æœ€å°é«˜åº¦æ”¹å° */
            min-height: 140px;

            cursor: pointer;
            transition: transform 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;

            filter: drop-shadow(0 5px 10px rgba(161, 140, 209, 0.2));
        }

        .cloud-card:hover {
            transform: translateY(-5px) scale(1.05); /* é¼ æ ‡æ”¾ä¸Šå»ç¨å¾®æ”¾å¤§ä¸€ç‚¹ç‚¹ */
            filter: drop-shadow(0 10px 20px rgba(161, 140, 209, 0.3));
            z-index: 10;
        }

        /* å†…éƒ¨æ–‡å­—æ ·å¼ï¼šå­—å·ç¼©å° */
        .cloud-date {
            font-size: 11px; /* ç¼©å° */
            color: #aaa;
            margin-bottom: 4px;
            text-align: center;
        }

        .cloud-title {
            font-size: 16px; /* ç¼©å° */
            font-weight: 800;
            color: #444;
            margin-bottom: 6px;
            text-align: center;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .cloud-content {
            font-size: 13px; /* ç¼©å°ï¼Œèƒ½æ˜¾ç¤ºæ›´å¤šå­— */
            line-height: 1.5;
            color: #666;
            flex-grow: 1;
            /* é™åˆ¶æ˜¾ç¤º 3 è¡Œï¼Œå› ä¸ºå¡ç‰‡å˜çŸ®äº† */
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-align: center;
            font-family: 'Comic Sans MS', 'Pretendard', sans-serif;
        }

        /* åº•éƒ¨æ“ä½œæŒ‰é’® */
        .cloud-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        /* æŒ‰é’®ç¨å¾®æ”¹å°ä¸€ç‚¹ */
        .cloud-actions .el-button.is-circle {
            width: 24px;
            height: 24px;
            padding: 5px;
        }

        .cloud-card:hover .cloud-actions {
            opacity: 1;
        }

        /* --- å¼¹çª—æ ·å¼ --- */
        .custom-dialog {
            border-radius: 20px !important;
            background: #fffdf5 !important;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1) !important;
        }
        .cloud-input .el-textarea__inner,
        .cloud-input .el-input__wrapper {
            background-color: #fff !important;
            border: 2px dashed #d1d9e6;
            border-radius: 20px;
            padding: 15px;
            box-shadow: none !important;
        }
        .cloud-input .el-textarea__inner:focus {
            border-color: #a18cd1;
            background-color: #f9f9ff !important;
        }

        /* æ‰‹æœºé€‚é… */
        @media (max-width: 768px) {
            .cloud-grid {
                /* æ‰‹æœºä¸Šä¸€è¡Œæ”¾ä¸¤ä¸ªï¼Œç¨å¾®æŒ¤ä¸€ç‚¹ä½†èƒ½çœ‹æ›´å¤š */
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            .cloud-card {
                padding: 25px 15px;
                min-height: 120px;
            }
            .nav-header { flex-direction: column; }
            .cloud-content { -webkit-line-clamp: 2; } /* æ‰‹æœºä¸Šåªæ˜¾ç¤º2è¡Œ */
        }
    </style>
</head>
<body>
<div id="app">
    <div class="main-container">
        <!-- å¤´éƒ¨ -->
        <div class="nav-header">
            <div class="app-title">
                <span style="font-size: 24px;">ğŸŒˆ</span>
                <span>æˆ‘çš„äº‘ç«¯æ—¥è®°æœ¬</span>
            </div>
            <el-button color="#fff" round size="default" @click="openAddDialog" style="color: #8ec5fc; font-weight: 900; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
                <el-icon style="margin-right: 6px"><Edit /></el-icon> è®°ä¸€ç¬”
            </el-button>
        </div>

        <!-- åŠ è½½ -->
        <div v-if="loading" style="text-align: center; padding: 60px; color: #fff;">
            <el-icon class="is-loading" size="30"><Loading /></el-icon>
            <div style="margin-top: 10px; font-weight: bold; font-size: 14px; text-shadow: 1px 1px 2px rgba(0,0,0,0.1);">æ­£åœ¨æ•æ‰äº‘æœµ...</div>
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <el-empty v-if="!loading && diaryList.length === 0" description="è¿™é‡Œå¥½ç©ºï¼Œå¿«æ”¾é£ç¬¬ä¸€æœµäº‘å§ï¼" :image-size="150"></el-empty>

        <!-- äº‘æœµåˆ—è¡¨ -->
        <div class="cloud-grid" v-if="!loading && diaryList.length > 0">
            <div class="cloud-card" v-for="item in diaryList" :key="item.id" @click="showDetail(item)">
                <div class="cloud-date">{{ formatTime(item.createTime) }}</div>
                <div class="cloud-title">{{ item.title }}</div>
                <div class="cloud-content">{{ item.content }}</div>

                <div class="cloud-actions" @click.stop>
                    <el-button type="primary" size="small" circle color="#a18cd1" @click="openEditDialog(item)">
                        <el-icon size="12"><Edit-Pen /></el-icon>
                    </el-button>
                    <el-popconfirm title="è®©è¿™æœµäº‘æ¶ˆæ•£å—ï¼Ÿ" @confirm="handleDelete(item.id)">
                        <template #reference>
                            <el-button type="danger" size="small" circle color="#ff9a9e">
                                <el-icon size="12"><Delete /></el-icon>
                            </el-button>
                        </template>
                    </el-popconfirm>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼¹çª— -->
    <el-dialog v-model="dialogVisible" :title="isEditMode ? 'ä¿®å‰ªäº‘æœµ' : 'æä¸€æœµæ–°äº‘å½©'" width="85%" style="max-width: 500px;" class="custom-dialog">
        <el-form :model="form">
            <el-form-item>
                <el-input v-model="form.title" placeholder="æ ‡é¢˜..." class="cloud-input" size="large" style="font-weight: bold; font-size: 16px;"></el-input>
            </el-form-item>
            <el-form-item>
                <el-input v-model="form.content" type="textarea" :rows="8" placeholder="å†™ä¸‹ä½ çš„å¿ƒæƒ…..." class="cloud-input" resize="none"></el-input>
            </el-form-item>
        </el-form>
        <template #footer>
            <el-button @click="dialogVisible = false" round>ç®—äº†</el-button>
            <el-button color="#8ec5fc" @click="submitDiary" round style="color: white; font-weight: bold;">æ”¾é£</el-button>
        </template>
    </el-dialog>

    <el-dialog v-model="detailVisible" :title="currentDiary.title" width="85%" style="max-width: 500px;" class="custom-dialog" align-center>
        <div style="font-size: 12px; color: #bbb; text-align: center; margin-bottom: 20px;">
            {{ formatTime(currentDiary.createTime) }}
        </div>
        <div style="line-height: 1.8; color: #555; white-space: pre-wrap; padding: 0 10px; font-family: 'Comic Sans MS', sans-serif;">{{ currentDiary.content }}</div>
    </el-dialog>
</div>

<script>
    const { createApp, ref, reactive, onMounted } = Vue;
    const { ElMessage } = ElementPlus;
    const { Edit, Loading, EditPen, Delete } = ElementPlusIconsVue;

    const app = createApp({
        components: { Edit, Loading, EditPen, Delete },
        setup() {
            const API_BASE_URL = '/diary';
            const diaryList = ref([]);
            const loading = ref(false);
            const dialogVisible = ref(false);
            const detailVisible = ref(false);
            const isEditMode = ref(false);
            const currentDiary = ref({});
            const form = reactive({ id: null, title: '', content: '' });

            const getList = () => {
                loading.value = true;
                axios.get(API_BASE_URL + '/getAll')
                    .then(res => {
                        if(res.data.code === 200) diaryList.value = res.data.data.reverse();
                    })
                    .finally(() => loading.value = false);
            };

            const openAddDialog = () => {
                isEditMode.value = false; form.id = null; form.title = ''; form.content = '';
                dialogVisible.value = true;
            };

            const openEditDialog = (item) => {
                isEditMode.value = true; Object.assign(form, item);
                dialogVisible.value = true;
            };

            const submitDiary = () => {
                if(!form.title || !form.content) return ElMessage.warning('äº‘å½©ä¸èƒ½ä¸ºç©ºå“¦');
                const url = isEditMode.value ? '/update' : '/add';
                axios.post(API_BASE_URL + url, form).then(res => {
                    if(res.data.code === 200) {
                        ElMessage.success('æˆåŠŸ'); dialogVisible.value = false; getList();
                    }
                });
            };

            const handleDelete = (id) => {
                axios.post(API_BASE_URL + '/delete?id=' + id).then(res => {
                    if(res.data.code === 200) { ElMessage.success('å·²æ¶ˆæ•£'); getList(); }
                });
            };

            const showDetail = (item) => {
                currentDiary.value = item; detailVisible.value = true;
            };

            const formatTime = (str) => {
                if(!str) return '';
                if(Array.isArray(str)) {
                    const pad = n => n < 10 ? '0'+n : n;
                    return `${str[0]}-${pad(str[1])}-${pad(str[2])} ${pad(str[3] || 0)}:${pad(str[4] || 0)}`;
                }
                return str.replace('T', ' ').substring(0, 16);
            };

            onMounted(() => getList());

            return {
                diaryList, loading, dialogVisible, detailVisible,
                form, currentDiary, isEditMode,
                openAddDialog, openEditDialog, submitDiary, handleDelete, showDetail, formatTime
            };
        }
    });

    app.use(ElementPlus);
    app.mount('#app');
</script>
</body>
</html>
